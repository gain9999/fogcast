<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fog Forecast API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .current-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .info-card .label {
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
        }
        .info-card .value {
            font-size: 1.2em;
            color: #333;
            margin-top: 5px;
        }
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .forecast-hour {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .forecast-hour.current {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        .day-forecasts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        .day-forecast {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .time-periods {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .time-period {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 4px;
            flex: 1;
            margin: 0 2px;
            border: 1px solid #ddd;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå´Ô∏è Fog Forecast API Test</h1>
        <div style="margin-bottom: 20px;">
            <label for="api-url" style="display: block; margin-bottom: 5px; font-weight: bold;">API URL:</label>
            <input type="text" id="api-url" placeholder="Enter API URL (e.g., https://fogcast.pages.dev/ or http://localhost:8788/)" 
                   style="width: 60%; padding: 8px; margin-right: 10px;" value="https://fogcast.pages.dev/">
            <button onclick="fetchData()" style="padding: 8px 20px; font-size: 16px;">Fetch Data</button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">Loading fog forecast data...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="content" style="display: none;">
            
            <!-- Current Conditions -->
            <div class="section">
                <h2>Current Conditions</h2>
                <div id="location-info"></div>
                <div class="current-info" id="current-conditions">
                    <!-- Current data will be inserted here -->
                </div>
            </div>

            <!-- 24-Hour Forecast -->
            <div class="section">
                <h2>24-Hour Forecast</h2>
                <div class="forecast-grid" id="hourly-forecast">
                    <!-- Hourly data will be inserted here -->
                </div>
            </div>

            <!-- Daily Forecasts -->
            <div class="section">
                <h2>Daily Forecasts</h2>
                <div class="day-forecasts" id="daily-forecasts">
                    <!-- Daily forecast data will be inserted here -->
                </div>
            </div>

            <!-- Raw JSON -->
            <div class="section">
                <h2>Raw JSON Response</h2>
                <pre id="raw-json"></pre>
            </div>
        </div>
    </div>

    <script>
        async function fetchData() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const content = document.getElementById('content');
            
            loading.style.display = 'block';
            error.style.display = 'none';
            content.style.display = 'none';
            
            try {
                const apiUrl = document.getElementById('api-url').value.trim();
                if (!apiUrl) {
                    throw new Error('Please enter an API URL');
                }
                
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                displayData(data);
                
                loading.style.display = 'none';
                content.style.display = 'block';
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = `Error loading data: ${err.message}`;
                console.error('Fetch error:', err);
            }
        }

        function displayData(data) {
            // Display location info
            document.getElementById('location-info').innerHTML = `
                <div class="info-card">
                    <div class="label">Location</div>
                    <div class="value">${data.location}</div>
                </div>
                <div class="info-card">
                    <div class="label">Coordinates</div>
                    <div class="value">${data.coordinates.lat}, ${data.coordinates.lon}</div>
                </div>
                <div class="info-card">
                    <div class="label">Last Updated</div>
                    <div class="value">${data.updated_local}</div>
                </div>
            `;

            // Display current conditions
            const current = data.current;
            document.getElementById('current-conditions').innerHTML = `
                <div class="info-card">
                    <div class="label">Fog Coverage</div>
                    <div class="value">${current.fog_area_fraction}%</div>
                </div>
                <div class="info-card">
                    <div class="label">Visibility Status</div>
                    <div class="value">${current.visibility_status}</div>
                </div>
                <div class="info-card">
                    <div class="label">Humidity</div>
                    <div class="value">${current.relative_humidity}%</div>
                </div>
                <div class="info-card">
                    <div class="label">Cloud Coverage</div>
                    <div class="value">${current.cloud_area_fraction}%</div>
                </div>
            `;

            // Display 24-hour forecast
            const hourlyContainer = document.getElementById('hourly-forecast');
            hourlyContainer.innerHTML = data.forecast_24h.map(hour => `
                <div class="forecast-hour ${hour.hours_ahead === 0 ? 'current' : ''}">
                    <div style="font-weight: bold; margin-bottom: 10px;">
                        ${hour.hours_ahead === 0 ? 'Current' : `+${hour.hours_ahead}h`}
                    </div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                        ${new Date(hour.time).toLocaleString()}
                    </div>
                    <div><strong>Fog:</strong> ${hour.fog_area_fraction}%</div>
                    <div><strong>Status:</strong> ${hour.visibility_status}</div>
                    <div><strong>Humidity:</strong> ${hour.relative_humidity}%</div>
                    <div><strong>Clouds:</strong> ${hour.cloud_area_fraction}%</div>
                </div>
            `).join('');

            // Display daily forecasts
            const dailyContainer = document.getElementById('daily-forecasts');
            const dailyForecasts = Object.keys(data)
                .filter(key => key.startsWith('forecast_') && key.endsWith('d'))
                .sort((a, b) => {
                    const numA = parseInt(a.match(/\d+/)[0]);
                    const numB = parseInt(b.match(/\d+/)[0]);
                    return numA - numB;
                });

            dailyContainer.innerHTML = dailyForecasts.map(key => {
                const dayNumber = key.match(/\d+/)[0];
                const forecast = data[key];
                return `
                    <div class="day-forecast">
                        <div style="font-weight: bold; margin-bottom: 10px;">
                            Day ${dayNumber}
                        </div>
                        <div class="time-periods">
                            ${forecast.morning ? `
                                <div class="time-period">
                                    <div style="font-weight: bold;">Morning</div>
                                    <div>${forecast.morning}</div>
                                </div>
                            ` : ''}
                            ${forecast.afternoon ? `
                                <div class="time-period">
                                    <div style="font-weight: bold;">Afternoon</div>
                                    <div>${forecast.afternoon}</div>
                                </div>
                            ` : ''}
                            ${forecast.night ? `
                                <div class="time-period">
                                    <div style="font-weight: bold;">Night</div>
                                    <div>${forecast.night}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Display raw JSON
            document.getElementById('raw-json').textContent = JSON.stringify(data, null, 2);
        }

        // Load data when page loads
        window.addEventListener('load', fetchData);
    </script>
</body>
</html>